(function(){var h,p,m=function(d,a){return function(){return d.apply(a,arguments)}};angular.module("akop",["akop-multi-select","akop-keymap","akop-query-filter"]);angular.module("akop-keymap",[]).config(["$provide",function(d){return d.constant("KEYCODES",{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause_break:19,caps:20,esc:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,
d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,left_window:91,right_window:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,"*":106,"+":107,minus:109,decimal_point:110,"%":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,num_lock:144,scroll_lock:145,";":186,"=":187,"":188,"-":189,".":190,"/":191,
grave_accent:192,"{":219,"\\":220,"}":221,"'":222})}]);h=function(d){var a,c,b,l;b=function(a,b,c){null==c&&(c=!0);c||a.sort()&&b.sort();return a.length===b.length&&a.every(function(a,c){return a===b[c]})};l=function(b){var c;c=[];b.altKey&&c.push(a("alt"));b.ctrlKey&&c.push(a("ctrl"));b.shiftKey&&c.push(a("shift"));c.push(parseInt(b.keyCode));return c};a=function(a){return d[a]};c=function(b){return _.map(b.split("-"),function(b){return a(b)})};return{codeFor:a,parseCombo:c,comboEventMatch:function(a,
d){return b(l(d),c(a),!1)}}};h.$inject=["KEYCODES"];angular.module("akop-keymap").service("KeymapUtils",h);angular.module("akop-multi-select",[]);p=function(){function d(a,c){var b,d,f,e;this.list=a;this.root=c;this.moveToNext=m(this.moveToNext,this);this.moveToPrev=m(this.moveToPrev,this);this.selectFirst=m(this.selectFirst,this);this.selectLast=m(this.selectLast,this);this.selectNext=m(this.selectNext,this);this.selectPrev=m(this.selectPrev,this);this.selected=[];if(this.root)this.reset(this.root);
else for(e=this.list,d=0,f=e.length;d<f;d++)b=e[d],b.selected&&this.include(b,!1)}d.prototype.reset=function(a){this.root=null!=a?a:null;_.each(this.list,function(a){a.selected=!1});this.selected=[];this.root&&this.include(this.root,!1);return this.selected};d.prototype.include=function(a,c){var b;null==c&&(c=!0);b=this._pos(a);if(0>b)throw Error("MultiSelect: Element must be a member of list.");if(c&&!this._isAdjacent(b))return!1;a.selected=!0;this.selected[b]=a;this.cursor=b;return this.selected};
d.prototype.includeUntil=function(a){var c,b,d;if(this.selected.length)for(b=this._pos(a),a=this.cursor,c=d=b;b<=a?d<=a:d>=a;c=b<=a?++d:--d)this.include(this.list[c],!1);else this.reset(a);return this.selected};d.prototype.exclude=function(a,c){var b,d;null==c&&(c=!0);b=this._pos(a);if(c){d=this._is_upper(b);b=this._is_lower(b);if(!d&&!b)return!1;d?(this.selected.pop(),this.cursor=this._upper_index()):(this.selected.splice(this._lower_index(),1,void 0),this.cursor=this._lower_index())}else this.selected.splice(b,
1,void 0),this.cursor=this._closest_selected_index(b);a.selected=!1;return this.selected};d.prototype.toggle=function(a){return a.selected?this.exclude(a,!1):this.include(a,!1)};d.prototype.moveCursorTo=function(a){var c;if(0>a||a>this.list.length-1)return this.selected;c=this.list[a];return c.selected?(c=this._is_desc(a,this.cursor)?1:-1,this.exclude(this.list[a+c])):this.include(c)};d.prototype.selectPrev=function(){return null!=this.cursor===!1||0===this.cursor?this.reset(_.last(this.list)):this.reset(this.list[this.cursor-
1])};d.prototype.selectNext=function(){return null!=this.cursor===!1||this.cursor===this.list.length-1?this.reset(this.list[0]):this.reset(this.list[this.cursor+1])};d.prototype.selectLast=function(){return this.reset(_.last(this.list))};d.prototype.selectFirst=function(){return this.reset(_.first(this.list))};d.prototype.moveToPrev=function(){return this.moveCursorTo(this.cursor-1)};d.prototype.moveToNext=function(){return this.moveCursorTo(this.cursor+1)};d.prototype._closest_selected_index=function(a,
c){var b,d,f;null==c&&(c=1);b=a+c;d=a-c;return 0>d&&b>this.list.length-1?!1:b<=this.list.length-1&&(f=this.list[b],f.selected)?b:0<=d&&(b=this.list[d],b.selected)?d:this._closest_selected_index(a,c+1)};d.prototype._is_asc=function(a,c){return 1===a-c};d.prototype._is_desc=function(a,c){return-1===a-c};d.prototype._pos=function(a){return this.list.indexOf(a)};d.prototype._isAdjacent=function(a){return a-1===this._upper_index()||a+1===this._lower_index()};d.prototype._upper_index=function(){return this.selected.length-
1};d.prototype._lower_index=function(){var a;a=_.filter(this.selected,function(a){return a});return this.selected.indexOf(_.first(a))};d.prototype._is_upper=function(a){return this._upper_index()===a};d.prototype._is_lower=function(a){return this._lower_index()===a};return d}();angular.module("akop-multi-select").factory("MultiSelect",function(){return p});h=function(d,a,c){return{restrict:"A",link:function(b,l,f){var e,g;e=b.$new();g=function(a){return angular.element(a.target).scope()};e.getSelection=
function(a){return c(f.selectableName)(g(a))};e.keymap={up:function(){return b.multiSelect.selectPrev()},down:function(){return b.multiSelect.selectNext()},"shift-up":function(){return b.multiSelect.moveToPrev()},"shift-down":function(){return b.multiSelect.moveToNext()},"alt-down":function(){return b.multiSelect.selectLast()},"alt-up":function(){return b.multiSelect.selectFirst()},esc:function(){return b.multiSelect.reset()}};b.$watch(f.akopMultiSelect,function(c){return b.multiSelect=new a(c||[])});
b.multiSelectClickHandler=function(a,c){return a.shiftKey?b.multiSelect.includeUntil(c):a.metaKey?b.multiSelect.toggle(c):b.multiSelect.reset(c)};l.bind("keydown",function(a){return b.$apply(function(){var b,c,f,g;a.shiftKey&&$(l).addClass("akop-noselect");f=e.keymap;g=[];for(b in f)c=f[b],d.comboEventMatch(b,a)?(a.preventDefault(),g.push(c.call())):g.push(void 0);return g})});l.bind("keyup",function(a){return b.$apply(function(){if(a.shiftKey)return $(l).removeClass("akop-noselect")})});return l.bind("click",
function(a){return b.$apply(function(){return b.multiSelectClickHandler(a,e.getSelection(a))})})}}};h.$inject=["KeymapUtils","MultiSelect","$parse"];angular.module("akop-multi-select").directive("akopMultiSelect",h);angular.module("akop-query-filter",[]);h=function(d,a,c){var b;b=function(a,c,e){var g,k;for(null==e&&(e=[]);a.length;)g=d("filter")(c,a.pop(),!0),e.push(g),b(a,(k=_(c)).without.apply(k,g),e);return _(e).flatten()};return function(d,f){var e,g,k;f=a(f);k=f.group_by;delete f.group_by;e=
c.getArrayArguments(f);g=b(c.arrayArgsToExpressions(f),d);e=0<e.length?b([f],g):b([f],d);if(!k)return e;if(_.any(d,function(a){return void 0===a[k]}))throw Error('serviceQueryFilter: Missing group_by property "'+k+'" for some or all elements in list.');return _.groupBy(e,k)}};h.$inject=["$filter","akopParser","expressionUtils"];angular.module("akop-query-filter").filter("akopQuery",h);angular.module("akop-query-filter").factory("akopParser",function(){return function(d){var a,c,b,l,f,e,g,k,h;if(d===
Object(d)||!(1<d.split(":").length))return d;a=/(\w+):((\w+)|(\[.*\])|"(.*)")/g;for(b=[];c=a.exec(d);)b.push(c);l=function(a){return String(a).replace(/^[\s\"]+|[\s\"]+$/g,"")};d={};k=0;for(h=b.length;k<h;k++)c=b[k],a=c[1],c=c[5]||c[2],(e=c.match(/\[(.*)\]/))?(g=e[1].split(","),d[a]=function(){var a,b,c;c=[];a=0;for(b=g.length;a<b;a++)f=g[a],c.push(""+l(f));return c}()):d[a]=""+c;return d}});h=function(){function d(){}d.prototype.getArrayArguments=function(a){var c,b;return _.compact(function(){var d;
d=[];for(b in a)c=a[b],d.push(_.isArray(c)?{attr:b,arg:c}:void 0);return d}())};d.prototype.arrayArgsToExpressions=function(a){var c,b,d,f,e,g,k,h,m,n;d=[];m=this.getArrayArguments(a);e=0;for(k=m.length;e<k;e++)for(c=m[e],n=c.arg,g=0,h=n.length;g<h;g++)f=n[g],b={},b[c.attr]=f,delete a[c.attr],d.push(b);return d};return d}();angular.module("akop-query-filter").service("expressionUtils",h)}).call(this);
