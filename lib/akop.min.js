(function(){var g,q,m=function(d,b){return function(){return d.apply(b,arguments)}};angular.module("akop",["akop-multi-select","akop-keymap","akop-query-filter"]);angular.module("akop-keymap",[]).config(["$provide",function(d){return d.constant("KEYCODES",{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause_break:19,caps:20,esc:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,
d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,left_window:91,right_window:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,"*":106,"+":107,minus:109,decimal_point:110,"%":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,num_lock:144,scroll_lock:145,";":186,"=":187,"":188,"-":189,".":190,"/":191,
grave_accent:192,"{":219,"\\":220,"}":221,"'":222})}]);g=function(d){var b,a,c,l;c=function(a,b,c){null==c&&(c=!0);c||a.sort()&&b.sort();return a.length===b.length&&a.every(function(a,c){return a===b[c]})};l=function(a){var c;c=[];a.altKey&&c.push(b("alt"));a.ctrlKey&&c.push(b("ctrl"));a.shiftKey&&c.push(b("shift"));c.push(parseInt(a.keyCode));return c};b=function(a){return d[a]};a=function(a){return _.map(a.split("-"),function(a){return b(a)})};return{codeFor:b,parseCombo:a,comboEventMatch:function(b,
d){return c(l(d),a(b),!1)}}};g.$inject=["KEYCODES"];angular.module("akop-keymap").service("KeymapUtils",g);angular.module("akop-multi-select",[]);q=function(){function d(b,a){this.list=b;this.root=a;this.moveToNext=m(this.moveToNext,this);this.moveToPrev=m(this.moveToPrev,this);this.selectFirst=m(this.selectFirst,this);this.selectLast=m(this.selectLast,this);this.selectNext=m(this.selectNext,this);this.selectPrev=m(this.selectPrev,this);this.root&&this.reset(this.root)}d.prototype.reset=function(b){this.root=
null!=b?b:null;_.each(this.list,function(a){a.selected=!1});this.selected=[];this.root&&this.include(this.root,!1);return this.selected};d.prototype.include=function(b,a){var c;null==a&&(a=!0);c=this._pos(b);if(0>c)throw Error("MultiSelect: Element must be a member of list.");if(a&&!this._isAdjacent(c))return!1;b.selected=!0;this.selected[c]=b;this.cursor=c;return this.selected};d.prototype.includeUntil=function(b){var a,c,d;if(this.selected.length)for(c=this._pos(b),b=this.cursor,a=d=c;c<=b?d<=b:
d>=b;a=c<=b?++d:--d)this.include(this.list[a],!1);else this.reset(b);return this.selected};d.prototype.exclude=function(b,a){var c,d;null==a&&(a=!0);c=this._pos(b);if(a){d=this._is_upper(c);c=this._is_lower(c);if(!d&&!c)return!1;d?(this.selected.pop(),this.cursor=this._upper_index()):(this.selected.splice(this._lower_index(),1,void 0),this.cursor=this._lower_index())}else this.selected.splice(c,1,void 0),this.cursor=this._closest_selected_index(c);b.selected=!1;return this.selected};d.prototype.moveCursorTo=
function(b){var a;if(0>b||b>this.list.length-1)return this.selected;a=this.list[b];return a.selected?(a=this._is_desc(b,this.cursor)?1:-1,this.exclude(this.list[b+a])):this.include(a)};d.prototype.selectPrev=function(){return null!=this.cursor===!1||0===this.cursor?this.reset(_.last(this.list)):this.reset(this.list[this.cursor-1])};d.prototype.selectNext=function(){return null!=this.cursor===!1||this.cursor===this.list.length-1?this.reset(this.list[0]):this.reset(this.list[this.cursor+1])};d.prototype.selectLast=
function(){return this.reset(_.last(this.list))};d.prototype.selectFirst=function(){return this.reset(_.first(this.list))};d.prototype.moveToPrev=function(){return this.moveCursorTo(this.cursor-1)};d.prototype.moveToNext=function(){return this.moveCursorTo(this.cursor+1)};d.prototype._closest_selected_index=function(b,a){var c,d,h;null==a&&(a=1);c=b+a;d=b-a;return 0>d&&c>this.list.length-1?!1:c<=this.list.length-1&&(h=this.list[c],h.selected)?c:0<=d&&(c=this.list[d],c.selected)?d:this._closest_selected_index(b,
a+1)};d.prototype._is_asc=function(b,a){return 1===b-a};d.prototype._is_desc=function(b,a){return-1===b-a};d.prototype._pos=function(b){return this.list.indexOf(b)};d.prototype._isAdjacent=function(b){return b-1===this._upper_index()||b+1===this._lower_index()};d.prototype._upper_index=function(){return this.selected.length-1};d.prototype._lower_index=function(){var b;b=_.filter(this.selected,function(a){return a});return this.selected.indexOf(_.first(b))};d.prototype._is_upper=function(b){return this._upper_index()===
b};d.prototype._is_lower=function(b){return this._lower_index()===b};return d}();angular.module("akop-multi-select").factory("MultiSelect",function(){return q});g=function(d,b){return{restrict:"A",link:function(a,c,l){a.$watch(l.akopMultiSelect,function(c){return a.multiSelect=new b(c||[])});a.$watch(l.selectableName,function(){return a.selectableName=l.selectableName});a.keymap={up:function(){return a.multiSelect.selectPrev()},down:function(){return a.multiSelect.selectNext()},"shift-up":function(){return a.multiSelect.moveToPrev()},
"shift-down":function(){return a.multiSelect.moveToNext()},"alt-down":function(){return a.multiSelect.selectLast()},"alt-up":function(){return a.multiSelect.selectFirst()},esc:function(){return a.multiSelect.reset()}};c.bind("keydown",function(b){return a.$apply(function(){var e,l,f,n;b.shiftKey&&$(c).addClass("akop-noselect");f=a.keymap;n=[];for(e in f)l=f[e],d.comboEventMatch(e,b)?(b.preventDefault(),n.push(l.call())):n.push(void 0);return n})});c.bind("keyup",function(b){return a.$apply(function(){if(b.shiftKey)return $(c).removeClass("akop-noselect")})});
return c.bind("click",function(b){var c;c=angular.element(b.target).scope()[a.selectableName];return a.$apply(function(){return b.shiftKey?a.multiSelect.includeUntil(c):b.metaKey?c.selected?a.multiSelect.exclude(c,!1):a.multiSelect.include(c,!1):a.multiSelect.reset(c)})})}}};g.$inject=["KeymapUtils","MultiSelect"];angular.module("akop-multi-select").directive("akopMultiSelect",g);angular.module("akop-query-filter",[]);g=function(d,b,a){var c;c=function(a,b,e){var k,f;for(null==e&&(e=[]);a.length;)k=
d("filter")(b,a.pop(),!0),e.push(k),c(a,(f=_(b)).without.apply(f,k),e);return _(e).flatten()};return function(d,h){var e,k,f;h=b(h);f=h.group_by;delete h.group_by;e=a.getArrayArguments(h);k=c(a.arrayArgsToExpressions(h),d);e=0<e.length?c([h],k):c([h],d);if(!f)return e;if(_.any(d,function(a){return void 0===a[f]}))throw Error('serviceQueryFilter: Missing group_by property "'+f+'" for some or all elements in list.');return _.groupBy(e,f)}};g.$inject=["$filter","akopParser","expressionUtils"];angular.module("akop-query-filter").filter("akopQuery",
g);angular.module("akop-query-filter").factory("akopParser",function(){return function(d){var b,a,c,l,h,e,k,f,g;if(d===Object(d)||!(1<d.split(":").length))return d;b=/(\w+):((\w+)|(\[.*\])|"(.*)")/g;for(c=[];a=b.exec(d);)c.push(a);l=function(a){return String(a).replace(/^[\s\"]+|[\s\"]+$/g,"")};d={};f=0;for(g=c.length;f<g;f++)a=c[f],b=a[1],a=a[5]||a[2],(e=a.match(/\[(.*)\]/))?(k=e[1].split(","),d[b]=function(){var a,b,c;c=[];a=0;for(b=k.length;a<b;a++)h=k[a],c.push(""+l(h));return c}()):d[b]=""+a;
return d}});g=function(){function d(){}d.prototype.getArrayArguments=function(b){var a,c;return _.compact(function(){var d;d=[];for(c in b)a=b[c],d.push(_.isArray(a)?{attr:c,arg:a}:void 0);return d}())};d.prototype.arrayArgsToExpressions=function(b){var a,c,d,h,e,k,f,g,m,p;d=[];m=this.getArrayArguments(b);e=0;for(f=m.length;e<f;e++)for(a=m[e],p=a.arg,k=0,g=p.length;k<g;k++)h=p[k],c={},c[a.attr]=h,delete b[a.attr],d.push(c);return d};return d}();angular.module("akop-query-filter").service("expressionUtils",
g)}).call(this);
